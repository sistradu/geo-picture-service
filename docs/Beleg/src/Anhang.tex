\section{CD-Inhalt}
\label{secCDInhalt}
Auf der beiliegenden CD befinden sich folgende \textit{Dateien} und \textbf{Ordner}:
\begin{itemize}
	\item \textbf{Beleg}
	\begin{itemize}
		\item \textit{Beleg.pdf} - dieses Dokument im PDF-Format
		\item \textbf{src} - enthält alle LaTeX-Quelldateien für die Erstellung des Belegs
		\begin{itemize}
			\item \textbf{img} - enthält alle im Beleg eingebundenen Grafiken
		\end{itemize}
	\end{itemize}
\end{itemize}

\section{UML-Diagramme}
\label{secAnhang}

\section{Listings}

\begin{lstlisting}[caption=Beispiel für einen Eintrag in der nutzers.xhtml,label=JumpListingNutzerXML,language=XML]
<nutzer>
    <id>0</id>
    <name>Karl</name>
    <password>98f6bcd4621d373cade4e832627b4f6</password>
    <email>karl@web.de</email>
</nutzer>
\end{lstlisting}
\begin{lstlisting}[caption=Beispiel für einen Eintrag in der alben.xhtml,label=JumpListingAlbumXML,language=XML]
<album>
    <id>0</id>
    <name>Görlitz</name>
    <password>9e229f114819f62674b5b1a031a9f91</password>
    <description>Bilder über die Stadt Görlitz.</description>
    <nutzer>0</nutzer>
</album>\end{lstlisting}
\begin{lstlisting}[caption=Beispiel für einen Eintrag in der bilder.xhtml,label=JumpListingBildXML,language=XML]
<bild>
    <id>2</id>
    <name>Vogtshof Innenhof</name>
    <description>Studenten beim Grillen</description>
    <ispublic>false</ispublic>
    <date>2011-02-21 19:05:01</date>
    <fileposition>/pics/Vogtshof_Innenhof_3.jpg</fileposition>
    <album>0</album>
    <position>
        <latitude>51.148833</latitude>
        <longitude>51.148833</longitude>
        <altitude>123</altitude>
        <direction>120</direction>
    </position>
</bild>
\end{lstlisting}
\begin{lstlisting}[caption=Die Klasse MockAlbumConnector,label=JumpListingMockAlbumConnector]
public class MockAlbumConnector implements IAlbumConnector {
  //Durch Mehrere HashMaps kann schnell und einfach auf bestimmte Alben zugegriffen werden
  private final HashMap<Integer, Document> albenIDMap;
  private final HashMap<String, Document> albenNameMap;
  private final HashMap<Integer, Document> albenNutzerIDMap;
  private final HashMap<String, Document> albenDescriptionMap;
  int id = -1;

  public MockAlbumConnector(){
    this.albenIDMap = new HashMap<Integer,Document>();
    this.albenNameMap = new HashMap<String,Document>();
    this.albenNutzerIDMap = new HashMap<Integer,Document>();
    this.albenDescriptionMap = new HashMap<String,Document>();
    //Passwortverschlüsselung für ein Album
    String password = "goerlitz";
    try {
      MessageDigest md = MessageDigest.getInstance("md5");
      byte[] digest = md.digest(password.getBytes());
      StringBuffer hexString = new StringBuffer();
      for (int i = 0; i < digest.length; i++) {
        hexString.append(Integer.toHexString(0xFF & digest[i]));
      }
      password = hexString.toString();
    } catch (NoSuchAlgorithmException e) {
      e.printStackTrace();
    }
    //Erstellen eines neuen Documents für ein Album
    this.addAlbum("Görlitz", password, "Bilder über die Stadt Görlitz.", 0);
    ...
  }
  ...
  public Document getAlbumByID(int id) throws ConnectException, IllegalArgumentException {
    if(this.albenIDMap.containsKey(id))
      return this.albenIDMap.get(id);
    else
      throw new IllegalArgumentException("");
  }
  ...
  public Document getAllAlben() throws ConnectException {
    	...
      DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
      Document doc = factory.newDocumentBuilder().newDocument();
      Node albenNode = doc.createElement("alben");
      for(Map.Entry<Integer,Document> entry : this.albenIDMap.entrySet()){
        albenNode.appendChild(doc.adoptNode(entry.getValue().getFirstChild()));
      }
      doc.appendChild(albenNode);
      return doc;
      ...
  }

  //Liefert nur bestimmte Alben
  public Document getAlbenForNutzer(int nutzerID) throws ConnectException, IllegalArgumentException {
    	...
      DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
      Document doc = factory.newDocumentBuilder().newDocument();
      Node albenNode = doc.createElement("alben");
      for(Map.Entry<Integer,Document> entry : this.albenIDMap.entrySet()){
        if(entry.getValue().getElementsByTagName("nutzer").item(0).getTextContent().equals(""+nutzerID))
          albenNode.appendChild(doc.adoptNode(entry.getValue().getFirstChild()));
      }
      doc.appendChild(albenNode);
      return doc;
      ...
  }
  ...
}
\end{lstlisting}

\begin{lstlisting}[caption=Methode zum Erstellen der Marker, label=lstMakeMarker, language=Java]
    public void makeMarker() {
        simpleModel = new DefaultMapModel();
        AlbumController ac = (AlbumController) GPicSUtil.getBean("albumController");
        bilder = ac.getBilder();
        Polyline polyline = new Polyline();
        for (int i = 0; i < ac.getBilder().size(); i++){
            Bild bild = bilder.get(i);

            LatLng coord = new LatLng(Double.parseDouble(bild.getLatitude()), Double.parseDouble(bild.getLongitude()));

            polyline.getPaths().add(coord);

            Marker m  = new Marker(coord, bild.getName(), bild.getPath());

            simpleModel.addOverlay(m);
        }

        polyline.setStrokeWeight(5);
        polyline.setStrokeColor("#FF9900");
        polyline.setStrokeOpacity(0.7);

        simpleModel.addOverlay(polyline);
    }
\end{lstlisting}

\begin{lstlisting}[caption=Methode zur Erzeugung eines zufällligen Passworts, label=lstRandomPasswort, language=Java]
public String erzeugeZufallsPasswort(int length) {
        String allowedChars = "0123456789abcdefghijklmnopqrstuvwxyz";
        Random rand = new Random();
        int max = allowedChars.length();
        StringBuffer buffer = new StringBuffer();
        for (int i = 0; i < length; i++) {
            int value = rand.nextInt(max);
            buffer.append(allowedChars.charAt(value));
        }
        return buffer.toString();
    }
\end{lstlisting}

\begin{lstlisting}[caption=Methode für die MD5-Verschlüsselung, label=lstEncryptPasswort, language=Java]
public String encryptWithMD5(String passwort){
        StringBuffer hexString = new StringBuffer();
        try {
            MessageDigest md = MessageDigest.getInstance("md5");
            byte[] digest = md.digest(passwort.getBytes());
            for (int i = 0; i < digest.length; i++) {
                hexString.append(Integer.toHexString(0xFF & digest[i]));
            }
        } catch (NoSuchAlgorithmException e) {
            e.printStackTrace();  //To change body of catch statement use File | Settings | File Templates.
        }
        return hexString.toString();
    }
\end{lstlisting}

\begin{lstlisting}[caption=Methode für den Mailversand, label=lstMailversand, language=Java]
public String sendPasswortEmail() {
        try {
            String tempPasswort = new PasswortUtil().erzeugeZufallsPasswort(16);

            Document doc = conn.getNutzerByName(nutzerNamen);
            getNutzerIDAndEmail(doc);

            Properties props = new Properties();
            props.put("mail.smtp.auth", "true");
            props.put("mail.smtp.host", "mail.gmx.de");
            props.put("mail.smtp.socketFactory.port", "465");
            props.put("mail.smtp.socketFactory.class",
                    "javax.net.ssl.SSLSocketFactory");
            props.put("mail.smtp.port", 465);
            props.setProperty("mail.smtp.ssl.trust", "mail.gmx.de");
            Authenticator aut = new Authenticator() {
                @Override
                protected PasswordAuthentication getPasswordAuthentication() {
                    return new PasswordAuthentication("gpics@gmx.de", "gpics4XML");
                }
            };
            Session session = Session.getInstance(props, aut);
            MessagePropertiesBean msgPB = new MessagePropertiesBean();
            Message mail = new MimeMessage(session);
            mail.setFrom(new InternetAddress("gpics@gmx.de"));
            mail.setRecipients(Message.RecipientType.TO,
                    InternetAddress.parse(email));
            mail.setSubject(msgPB.getPropertiesMessage("mailSubject"));
            mail.setText(msgPB.getPropertiesMessage("mailPart1") + tempPasswort +
                    msgPB.getPropertiesMessage("mailPart2"));
            Transport.send(mail);
            System.out.println("Done");
            setPasswort(tempPasswort);
            conn.updateNutzer(nutzerID, nutzerNamen, passwort, email);
        } catch (NullPointerException e) {
            System.err.println(e.getMessage());  //Fängt NullPointerabException ab, die bei Unit-Tests auftritt, weil dort der FacesContext null ist.
        } catch (Exception e) {
            e.printStackTrace();
            GPicSUtil.createFacesMessageForID("sendPWMask", e.getMessage(), true);
            return "sendPW";
        }
        try {
            MessagePropertiesBean mPB = new MessagePropertiesBean();
            GPicSUtil.createFacesMessageForID("infoMessages", mPB.getPropertiesMessage("sendMailSuccess"), false);
        } catch (NullPointerException e) {
            System.err.println(e.getMessage()); //Fängt NullPointerabException ab, die bei Unit-Tests auftritt, weil dort der FacesContext null ist.
        }
        return "index";
    }
\end{lstlisting}

\begin{lstlisting}[caption=Methode zur Behandlung des FileUploadEvents, label=lstHandleFileUpload, language=Java]
public void handleFileUpload(FileUploadEvent event) {
        UploadedFile file = event.getFile();

        try {
            UserController uc = (UserController) GPicSUtil.getBean("userController");
            String username = uc.getNutzerNamen();
            FileOutputStream out = null;
            if(!isNewAlbum){
                out = new FileOutputStream(uploadDir + albumName + "_" + username + "_" + file.getFileName());
            }else{
                out = new FileOutputStream(uploadDir + username + "_" + file.getFileName());
            }
//            FileOutputStream
            out.write(file.getContents());
            out.flush();
            out.close();
            if(!isNewAlbum){
                updateBilderListe(uploadDir + albumName + "_" + username + "_" + file.getFileName());
            }else{
                updateBilderListe(uploadDir + username + "_" + file.getFileName());
            }

            if (!isNewAlbum) {
                //TODO aufruf von ladeAlbum probieren
                AlbumControllerDBUtil util = new AlbumControllerDBUtil();
                setBilder(util.ladeBilderAusDB(albumID));
//            FacesContext.getCurrentInstance().getExternalContext().redirect("createAlbum.xhtml");
            }
        } catch (Exception e) {
            e.printStackTrace();  //To change body of catch statement use File | Settings | File Templates.
        }
        GPicSUtil.createFacesMessageForID("uploader", file.getFileName() + " erfolgreich hochgeladen.", false);
    }
\end{lstlisting}

\begin{lstlisting}[caption=Parameterübergabe von einer Webseite an den Controller, label=lstFParam, language=XML]
<p:dataGrid id="cgrid" var="b" value="#{createEditAlbumController.bilder}" columns="3" rows="12" paginator="false" effect="true" paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" rowsPerPageTemplate="9,12,15">
....
                            <p:graphicImage value="#{createEditAlbumController.image}" width="20%"
                                            height="20%">
                                <f:param name="name" value="#{b.name}"/>
                            </p:graphicImage>
....
            </p:dataGrid>
\end{lstlisting}

\begin{lstlisting}[caption=Methode zum Laden der Bilder, label=lstGetImage, language=Java]
public StreamedContent getImage() {
        StreamedContent defaultImage = null;
        try {
            defaultImage = GPicSUtil.getStreamContent(uploadDir + "/gpics.jpg");
            String name = FacesContext.getCurrentInstance()
                    .getExternalContext().getRequestParameterMap().get("name");
            if (name != null && !bilder.isEmpty()) {
                StreamedContent content = null;
                for (Bild b : bilder) {
                    if (b.getName().equals(name)) {
                        content = b.getContent();
                    }
                }
                return content;
            }
        } catch (IOException e) {
            e.printStackTrace();  //To change body of catch statement use File | Settings | File Templates.
        }
        return defaultImage;
    }
\end{lstlisting}
%	\label{pageValidationCall}
%	\includepdf[landscape, turn=true, pages=-, fitpaper=true]{img/Validation_Call.pdf}
	